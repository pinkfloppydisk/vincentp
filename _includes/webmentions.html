{% if site.webmentionTestUrl == false %}
    {% assign thisUrl =  page.url | absolute_url %}
{% else %}
    {% assign thisUrl =  "https://vincentp.me" | append: page.url %}
{% endif %}

{% assign repostsCount = 0 %}
{% assign likesCount = 0 %}
{% assign replyCount = 0 %}
{% assign mentionCount = 0 %}
{% assign bookmarkCount = 0 %}
{% assign rsvpCount = 0 %}

{% assign bookmarks = site.data.bookmarks %}
{% assign likes = site.data.likes %}
{% assign mentions = site.data.mentions %}
{% assign replies = site.data.replies %}
{% assign reposts = site.data.reposts %}
{% assign rsvps = site.data.rsvps %}

{% for bookmark in bookmarks %}
    {% if thisUrl == bookmark[1].bookmark-of %}
        {% assign bookmarkCount = bookmarkCount | plus: 1 %}
    {% endif %}
{% endfor %}

{% for like in likes %}
    {% if thisUrl == like[1].like-of %}
        {% assign likesCount = likesCount | plus: 1 %}
    {% endif %}
{% endfor %}

{% for mention in mentions %}
    {% if thisUrl == mention[1].mention-of %}
        {% assign mentionCount = mentionCount | plus: 1 %}
    {% endif %}
{% endfor %}

{% for reply in replies %}
    {% if thisUrl == reply[1].in-reply-to %}
        {% assign replyCount = replyCount | plus: 1 %}
    {% endif %}
{% endfor %}

{% for repost in reposts %}
    {% if thisUrl == repost[1].repost-of %}
        {% assign repostsCount = repostsCount | plus: 1 %}
    {% endif %}
{% endfor %}

{% for rsvpMention in rsvps %}
    {% if thisUrl == rsvpMention[1].rsvp%}
        {% assign rsvpCount = rsvpCount | plus: 1 %}
    {% endif %}
{% endfor %}


{% if likesCount > 0 and page.disableWebmention != true %}
    <h3>Likes</h3>
    {% for like in likes %}
        {% if thisUrl == like[1].like-of %}
        <div class="p-like h-cite dib">
            <a href="{{like[1].url}}" class="u-url">
                <span class="p-author h-card">
                    <img width="30" height="30" src="{{like[1].author.photo }}" alt="{{like[1].author.name }}" class="u-photo pa-fixed-1 br-circle b-light-grey ba bg-white">
                </span>
            </a>
        </div>
       {% endif %}
    {% endfor %}
{% endif %}

{% if replyCount > 0 and page.disableWebmention != true %}
    <h3>Replies</h3>
    {% for reply in replies %}
        {% if thisUrl == reply[1].in-reply-to %}
             <div class="p-comment h-cite mb5">
                <h3 class="p-author h-card dg ma0 pa0 webmention-mini-two-col-grid"><img width="30" height="30" src="{{reply[1].author.photo }}" alt="{{reply[1].author.name }}" class="u-photo pa-fixed-1 br-circle avatar-stack b-light-grey ba bg-white"> <a href="{{reply[1].author.url}}" class="p-name u-url f5 red ma0 pa0 rm-underline" rel="external">{{reply[1].author.name}}</a></h3>
                <div class="e-content p-name">{{reply[1].content.text}}</div>
                    <time class="dt-published db f7" datetime="{{reply[1].published | date_to_xmlschema}}"><a href="{{reply[1].url}}" class="grey  rm-underline " rel="external">{{ reply[1].published | date_to_string: "ordinal" }} <span>at</span> {{ reply[1].published | date: "%H" }}:{{ reply[1 ].published | date: "%M%P" }}</a></time>
                </div>
            {% endif %}
        {% endfor %}
{% endif %}

{% if bookmarkCount > 0 and page.disableWebmention != true %}
    <h3>Bookmarks</h3>
    {% for bookmark in bookmarks %}
        {% if thisUrl == bookmark[1].bookmark-of %}
            <div class="p-bookmark h-cite dib">
                <a href="{{bookmark[1].url}}" class="u-url">
                    <span class="p-author h-card">
                        <img width="30" height="30" src="{{bookmark[1].author.photo }}" alt="{{bookmark[1].author.name }}" class="u-photo pa-fixed-1 br-circle b-light-grey ba bg-white">
                    </span>
                </a>
            </div>
        {% endif %}
    {% endfor %}
    <p class="h-cite p-comment reply-relation mb2 f6">{{bookmarkCount}} Bookmarks</p>
{% endif %}

{% if repostsCount > 0 and page.disableWebmention != true %}
    <h3>Reposts</h3>
    {% for repost in reposts %}
        {% if thisUrl == repost[1].repost-of %}
            <div class="p-repost h-cite dib">
                <a href="{{repost[1].url}}" class="u-url">
                    <span class="p-author h-card">
                        <img width="30" height="30" src="{{repost[1].author.photo }}" alt="{{repost[1].author.name }}" class="u-photo pa-fixed-1 br-circle b-light-grey ba bg-white">
                    </span>
                </a>
            </div>
        {% endif %}
    {% endfor %}
<p class="h-cite p-comment reply-relation mb2 f6">{{repostsCount}} Reposts</p>
{% endif %}

{% if mentionCount > 0 and page.disableWebmention != true %}
    <h3>Mentions</h3>
    {% for mention in mentions %}
        {% if thisUrl == mention[1].mention-of %}
            <div class="p-mention h-cite dib">
                <a href="{{mention[1].wm-source}}" class="u-url">
                    <span class="p-author h-card">
                        <img width="30" height="30" src="{{mention[1].author.photo }}" alt="{{mention[1].author.name }}" class="u-photo pa-fixed-1 br-circle b-light-grey ba bg-white">
                    </span>
                </a>
            </div>
        {% endif %}
    {% endfor %}
<p class="h-cite p-comment reply-relation mb2 f6">{{mentionCount}} Mentions</p>
{% endif %}
